<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
    <title>Document</title>
    <style>
      body {
        background-color: #e6e6fa;
      }
      table,
      td,
      th {
        border: none;
        border-collapse: collapse;
        text-align: left;
      }
      .categoryField {
        position: absolute;
        right: 772px;
        bottom: 478px;
        background-color: lightblue;
        width: 189px;
        height: 41px;
      }
      #fullTable {
        top: 200px;
        position: absolute;
      }
    </style>
  </head>
  <body>
    <input class="categoryField" />
    <button class="omsClick">submit</button>
    <div id="fullTable"></div>
  </body>
  <script>
    let categories = [];
    $(document).ready(function () {
      let table_body = "<table>";
      $(".omsClick").click(function () {
        if ($(".categoryField").val()) {
          categories.push({
            name: $(".categoryField").val(),
            data: [],
          });
          $(".categoryField").val("");
          buildTable();
        } else {
          alert("please enter main task");
        }
      });
    });
    function buildTable() {
      $("#fullTable").empty();
      var table_body = '<table style="padding-right: 50px;"> </br>';
      table_body += "<tr>";

      for (let i = 0; i < categories.length; i++) {
        const element = categories[i];
        table_body += `
            <th style="text-align: left;vertical-align: center; padding-right: 50px;" >
                <div style="background-color: #04aa6d; padding: 10px;">
                    <input type="checkbox" id="${i}">
                    <label for="${i}"> ${element.name}</label>
                    <button onclick="removeValueFromCategories(${i})" class="onclick" style=" float: right;">X</button>
                </div>
            </th>
        `;
      }
      table_body += `</tr><tr style="vertical-align: top;">`;
      for (let i = 0; i < categories.length; i++) {
        const element = categories[i];
        table_body += buildInnerTable(element.data ?? [], i);
      }
      table_body += "</tr></table>";
      $("#fullTable").html(table_body);
    }
    function buildInnerTable(innerList, index) {
      let tableData = `<td style="padding-right: 50px;"><table style="width:100%;background-color: #04aa6d; padding: 10px;">`;
      tableData += `<tr>
            <th><input class="categoryField${index}" placeholder="enter sub task"/></th>
            <th><button onclick="addValueToSubCategories(${index})">submit</button></th>
        </tr>`;
      for (let i = 0; i < innerList.length; i++) {
        const element = innerList[i];
        tableData += `
        <tr>
            <td><input type="checkbox" id="${index}${i}">${element}</td>
            <td>
                <center>
                    <button onclick="removeValueFromSubCategories(${index},${i})">X</button>
                </center>
            </td>
        </tr>`;
      }
      tableData += `</table></td>`;

      return tableData;
    }

    function addValueToSubCategories(index) {
      if ($(".categoryField" + index).val()) {
        categories[index].data.push($(".categoryField" + index).val());
        buildTable();
      } else {
        alert("please enter sub task");
      }
    }

    function removeValueFromSubCategories(catIndex, subCatIndex) {
      if ($(`#${catIndex}${subCatIndex}`).is(":checked")) {
        categories[catIndex].data.splice(subCatIndex, 1);
        buildTable();
      } else {
        alert(
          `select to delete the item '${categories[catIndex].data[subCatIndex]}'`
        );
      }
    }
    function removeValueFromCategories(catIndex) {
      if ($(`#${catIndex}`).is(":checked")) {
        categories.splice(catIndex, 1);
        buildTable();
      } else {
        alert(`select to delete the main list '${categories[catIndex].name}'`);
      }
    }
  </script>
</html>
